## Ранжирование по TF-IDF
Сортировка документов позволяет отображать сначала те результаты поиска, у которых больше общих слов с запросом. Такое ранжирование делает поиск эффективнее.

Но не все слова одинаково полезны при ранжировании. Встретить в документе слово «ошейник» гораздо важнее, чем слово «кличка»: понятно, что у большинства пропавших животных есть имя, а вот ошейником могут похвастаться не все. Ошейник — важное отличие.

Полезность слов оценивают понятием inverse document frequency или IDF. Эта величина — свойство слова, а не документа. Чем в большем количестве документов есть слово, тем ниже IDF. 

Рассчитывают IDF так:
- Количество всех документов, имеющихся в базе, делят на количество тех, где встречается слово. Не встречающиеся нигде слова в расчёт не берут, поэтому деления на ноль опасаться не надо. Важно, встречается ли слово в документе. А сколько раз встречается — всё равно.
- К результату деления применяют натуральный логарифм (логарифм по основанию `e`) — функцию `log` из библиотеки `<cmath>.`

Возьмите знакомый пример из трёх документов:
1. белый кот и модный ошейник
1. пушистый кот пушистый хвост
1. ухоженный пёс выразительные глаза
   
Вычислим IDF слова `кот`. Всего в базе три документа, слово встречается в двух. Делим 3 на 2, получаем 1,5. Далее применяем логарифм и получаем примерно 0,4055. Это и есть IDF.

Как видите, чем более редкое слово, тем выше его IDF.

Второй способ улучшить ранжирование — выше располагать документы, где искомое слово встречается более одного раза. Здесь нужно рассчитать term frequency или TF. Для конкретного слова и конкретного документа это доля, которую данное слово занимает среди всех.

Рассчитаем TF слова `кот` в документе 1. Всего слов в этом документе четыре, из них `кот` — только одно. 1 / 4 = 0,25. 


Слово `пушистый` встречается дважды, так что его TF в этом документе будет 2 / 4 = 0,5.
С TF и IDF вы точнее посчитаете релевантность документа запросу и улучшите ранжирование. Это делается так:
- вычисляется IDF каждого слова в запросе,
- вычисляется TF каждого слова запроса в документе,
- IDF каждого слова запроса умножается на TF этого слова в этом документе,
- все произведения IDF и TF в документе суммируются.

Чем больше сумма, тем релевантнее документ. Ранжирование, как и прежде, происходит по убыванию релевантности. Взгляните на пример.

По запросу `пушистый ухоженный кот` нашлись документы:
1. белый кот и модный ошейник
1. пушистый кот пушистый хвост
1. ухоженный пёс выразительные глаза
   

Чтобы узнать их релевантность, сначала для каждого из трёх слов запроса нужно вычислить IDF:
#### IDF слов запроса
Name	|пушистый|	ухоженный|	кот
|:-:|:-:|:-:|:-:|
   белый кот и модный ошейник|	не встречается|	не встречается|	встречается
   пушистый кот пушистый хвост	|встречается (неважно, сколько раз)|	не встречается	|встречается
   ухоженный пёс выразительные глаза	|не встречается|	встречается|	не встречается
IDF	|log(3 / 1) ≈ 1,0986|	log(3 / 1) ≈ 1,0986|	log(3 / 2) ≈ 0,4055

Затем посчитать TF слов запроса в каждом документе:

#### TF слов запроса в документах
Name	|пушистый	|ухоженный|	кот
|:-:|:-:|:-:|:-:|
IDF	| log(3 / 1) ≈ 1,0986	|log(3 / 1) ≈ 1,0986	|log(3 / 2) ≈ 0,4055
   белый кот и модный ошейник|	0 / 4 = 0|	0 / 4 = 0|	1 / 4 = 0,25
   пушистый кот пушистый хвост|	2 / 4 = 0,5|	0 / 4 = 0|	1 / 4 = 0,25
   ухоженный пёс выразительные глаза|	0 / 4 = 0	|1 / 4 = 0,25|	0 / 4 = 0
   
Умножить TF слова на его IDF и вычислить сумму таких произведений для каждого документа:

### TF-IDF

Name	|пушистый	|ухоженный	|кот	|Сумма TF-IDF по словам
|:-:|:-:|:-:|:-:|:-:|
белый кот и модный ошейник|	0 * 1,0986 = 0|	0 * 1,0986 = 0|	0,25 * 0,4055 ≈ 0,1014|	0,1014
пушистый кот пушистый хвост|	0,5 * 1,0986 = 0,5493|	0 * 1,0986 = 0|	0,25 * 0,4055 ≈ 0,1014|	0,6507
ухоженный пёс выразительные глаза|	0 * 1,0986 = 0|	0,25 * 1,0986 ≈ 0,2746|	0 * 0,4055 = 0|	0,2746

Суммы в правом столбце — это релевантность документов. После ранжирования результат будет таким:


Документ 1 ожидаемо оказался самым релевантным — из-за пересечения с запросом по двум словам и пушистости кота. Документы 0 и 2 одинаково неинтересны, но второй релевантнее, потому что слово «кот» в нулевом более частотное, а значит, менее интересное.

Словам `кот` и `пёс` можно придать одинаковую значимость, завысив их IDF. Но нам интересно общее решение.