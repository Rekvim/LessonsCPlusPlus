## Универсальный конвертер изображений

Последний формат, который вам предстоит добавить в свою библиотеку ImgLib, — BMP. Полученная программа будет поддерживать уже три формата изображений: BMP, PPM, JPEG.

Формат BMP похож на PPM, но имеет более сложный заголовок. Некоторые вариации поддерживают HDR и сжатие. Ваша библиотека будет работать только с изображениями простого формата — BGR24 без сжатия.

Для выполнения этой задачи придётся вспомнить о padding.

Данные в BMP записываются примерно как в PPM, но со следующими изменениями:

- строки идут в другом порядке, начиная с нижней,

- порядок компонент в пикселе обратный: Blue, Green, Red,

- отступ не всегда равен утроенной ширине: к каждой строке может добавляться padding, чтобы количество байт стало кратно четырём. Padding нужно заполнить нулевыми байтами. Формула для вычисления отступа приведена ниже.

Главное — правильно записать и прочитать заголовок. А заголовок в BMP сложный. Он состоит из двух частей: Bitmap File Header и Bitmap Info Header.

Bitmap File Header пишется в начале файла и имеет поля:

1. Подпись — 2 байта. Символы `BM`.

2. Суммарный размер заголовка и данных — 4 байта, беззнаковое целое. Размер данных определяется как отступ, умноженный на высоту изображения.

3. Зарезервированное пространство — 4 байта, заполненные нулями.

4. Отступ данных от начала файла — 4 байта, беззнаковое целое. Он равен размеру двух частей заголовка.

Bitmap Info Header пишется после первой части и имеет поля:

1. Размер заголовка — 4 байта, беззнаковое целое. Учитывается только размер второй части заголовка.

2. Ширина изображения в пикселях — 4 байта, знаковое целое.

3. Высота изображения в пикселях — 4 байта, знаковое целое.

4. Количество плоскостей — 2 байта, беззнаковое целое. В нашем случае всегда 1 — одна RGB плоскость.

5. Количество бит на пиксель — 2 байта, беззнаковое целое. В нашем случае всегда 24.

6. Тип сжатия — 4 байта, беззнаковое целое. В нашем случае всегда 0 — отсутствие сжатия.

7. Количество байт в данных — 4 байта, беззнаковое целое. Произведение отступа на высоту.

8. Горизонтальное разрешение, пикселей на метр — 4 байта, знаковое целое. Нужно записать 11811, что примерно соответствует 300 DPI.

9. Вертикальное разрешение, пикселей на метр — 4 байта, знаковое целое. Нужно записать 11811, что примерно соответствует 300 DPI.

10. Количество использованных цветов — 4 байта, знаковое целое. Нужно записать 0 — значение не определено.

11. Количество значимых цветов — 4 байта, знаковое целое. Нужно записать `0x1000000`.

Важно, что между полями отсутствует padding. Таким образом, размер первой части — 14 байт, размер второй части — 40 байт.

Отдельную сложность представляет вычисление отступа, который не пишется в заголовке, но тем не менее не всегда равен утроенной ширине. В BMP отступ равен ширине, умноженной на три и округлённой вверх до числа, делящегося на четыре. Его можно вычислить по ширине такой функцией:
```cpp
// деление, а затем умножение на 4 округляет до числа, кратного четырём
// прибавление тройки гарантирует, что округление будет вверх
int GetBMPStride(int w) {
    return 4 * ((w * 3 + 3) / 4);
} 
```
В заготовке кода будут определены макросы для отключения padding у структур, которые работают на разных компиляторах и платформах. Чтобы создать структуру `BitmapFileHeader` с отключённым padding, напишите определение в таком виде:
```
PACKED_STRUCT_BEGIN BitmapFileHeader {
    // содержимое структуры
}
PACKED_STRUCT_END
```