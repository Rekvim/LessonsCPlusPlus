## Виртуальные методы
Полиморфизм похож на магию. Самое настоящее волшебство. Вызов метода выглядит одинаково, но вызванные методы — разные:
```cpp
class MagicHat {
public:
    virtual void WhatInside() const {
        cout << "Nothing"s << endl;
    }
};

class HatWithApples : public MagicHat {
public:
    void WhatInside() const {
        cout << "Apple"s << endl;
    }
};

class HatWithRabbits : public MagicHat {
public:
    void WhatInside() const {
        cout << "Rabbit"s << endl;
    }
};

class HatWithDoves : public MagicHat {
public:
    void WhatInside() const {
        cout << "Dove"s << endl;
    }
};

void FocusPocus(const vector<MagicHat*> hats) {
    cout << "Let the magic begin..."s << endl;
    for (auto hat : hats) {
        hat->WhatInside();
    }
}

int main() {
    HatWithApples hat1;
    HatWithRabbits hat2;
    HatWithDoves hat3;
    vector<MagicHat*> hats = {&hat1, &hat2, &hat3};
    FocusPocus(hats);
}
```
В этом примере перед фокусником стоят три волшебные шляпы. Но из каждой из них он достаёт что-то разное: то кролика, то яблоко, то голубя. Вывод программы будет такой:
```
Let the magic begin...
Apple
Rabbit
Dove 
```
Программисты-новички представляют себе полиморфизм именно так — фокус, магия. В этой теме вы узнаете, как иллюзионист проворачивает свои фокусы, а также о его зарплате стоимости этой магии с точки зрения затрат памяти и быстродействия кода.

Нас пустили за кулисы, и теперь мы можем внимательно рассмотреть шляпы волшебника. Измерим одну из них:
```cpp
void FocusPocus(const vector<MagicHat*> hats) {
    cout << "Let the magic begin..."s << endl;
    for (auto hat : hats) {
        hat->WhatInside();
    }

    cout << "But the size of magic hat is "s << sizeof(MagicHat) << endl;
} 
```
Вывод программы:
```
Let the magic begin...
Apple
Rabbit
Dove
But the size of magic hat is 8
```
Размер шляпы равен 8, но ведь у неё совсем нет полей класса. 
А каким будет размер объекта без полей класса?

>1

Если позволить объекту иметь размер 0, может возникнуть ситуация, когда у разных объектов будет один и тот же адрес. Делать пустой объект размером 8 — непозволительная роскошь. Размер пустого объекта в C++ равен 1. Более подробно этот вопрос разбирается у [Бьёрна Страуструпа](https://www.stroustrup.com/bs_faq2.html#sizeof-empty) — автора языка С++.

Итак, у шляпы точно есть потайное дно, ведь ожидаемый размер был 1 байт, а реальный — 8. Вы уже знаете, что чтобы фокус получился, методу `WhatInside` в базовом классе шляпы нужно слово `virtual`.

Что выведет программа, если убрать слово `virtual` у метода `WhatInside` класса `MagicHat`?

> Волшебная шляпа без магии — уже совсем не волшебная. Вывод программы будет таким:
```
Nothing
Nothing
Nothing 
```

Без `virtual` вся магия пропала. Вызывается метод класса `MagicHat`.
Теперь уточним размер шляпы и получим ответ 1. Второе дно пропало. Попробуем добавить ещё виртуальных методов, чтобы понять, растёт ли размер потайного дна у шляпы, когда магии становится больше:
```cpp
class MagicHat {
public:
    virtual void WhatInside() const {
        cout << "Nothing"s << endl;
    }
    virtual bool HasSomethingInside() const {
        cout << "Nope"s << endl;
        return false;
    }
};

class HatWithApples : public MagicHat {
public:
    void WhatInside() const {
        cout << "Apple"s << endl;
    }
    bool HasSomethingInside() const {
        cout << "Yes. Something red and tasty"s << endl;
        return true;
    }
};

class HatWithRabbits : public MagicHat {
public:
    void WhatInside() const {
        cout << "Rabbit"s << endl;
    }
    bool HasSomethingInside() const {
        cout << "Yes. Several furry carrot lovers"s << endl;
        return true;
    }
};

class HatWithDoves : public MagicHat {
public:
    void WhatInside() const {
        cout << "Dove"s << endl;
    }
    bool HasSomethingInside() const {
        cout << "Yes. Flying symbol of peace"s << endl;
        return true;
    }
};

void FocusPocus(const vector<MagicHat*> hats) {
    cout << "Let the magic begin..."s << endl;
    int hat_num = 1;
    for (auto hat : hats) {
        cout << "Hat number "s << hat_num++ << " : " << endl;
        cout << "    Has something inside : "s;
        if (hat->HasSomethingInside()) {
            cout << "    And it is : "s;
            hat->WhatInside();
        }
    }
} 
```
Вывод программы:
```
Let the magic begin...
Hat number 1 :
    Has something inside : Yes. Something red and tasty
    And it is : Apple
Hat number 2 :
    Has something inside : Yes. Several furry carrot lovers
    And it is : Rabbit
Hat number 3 :
    Has something inside : Yes. Flying symbol of peace
    And it is : Dove
But the size of magic hat is 8
```
Размер шляпы с двумя виртуальными методами остался таким же, каким был с одним виртуальным методом. Говоря в терминах программирования: память, затраченная для реализации полиморфизма, константна.

Что это за 8 байт и в чём секрет фокуса — в следующем уроке.