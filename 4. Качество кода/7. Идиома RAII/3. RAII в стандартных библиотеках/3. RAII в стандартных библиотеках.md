## RAII –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –ø—Ä–æ–π–¥—ë–º –ø–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–º–µ—Ä–∞–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–¥–∏–æ–º—ã RAII –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö. –í—Å–µ —ç—Ç–∏ –ø—Ä–∏–º–µ—Ä—ã –≤–∞–º —É–∂–µ –∑–Ω–∞–∫–æ–º—ã, –Ω–æ –≤–∞–∂–Ω–æ –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–∏—Ö –∫–ª–∞—Å—Å–æ–≤.

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã

–°–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä RAII ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ª—é–±–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –í–Ω—É—Ç—Ä–∏ —Å–µ–±—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ö—Ä–∞–Ω–∏—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –ø–∞–º—è—Ç—å. –í–Ω—É—Ç—Ä–∏ –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–∞ —ç—Ç–∞ –ø–∞–º—è—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∞ –∏ –≤—ã–¥–µ–ª–µ–Ω–∞ –∑–∞–Ω–æ–≤–æ. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –≤–µ–∫—Ç–æ—Ä –ø–∞–º—è—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–≤—ã–¥–µ–ª–µ–Ω–∞. –í –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∂–µ –ø–∞–º—è—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è.

–ö –∫–∞–∫–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤—ã—à–µ –º–µ—Ö–∞–Ω–∏–∑–º? ‚Äî `array`, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ –Ω—ë–º –Ω–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å.

–í–æ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö, –∫—Ä–æ–º–µ `array`, –≤ —Ç–æ–º –∏–ª–∏ –∏–Ω–æ–º –≤–∏–¥–µ –µ—Å—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å, –∫–æ—Ç–æ—Ä–∞—è –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ. `array` —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç–µ–∫–µ, –∏ –Ω–∏—á–µ–≥–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### –£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏

–£—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ ‚Äî —á–∞—Å—Ç–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å ¬´—á–∏—Å—Ç—ã–º–∏¬ª —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–¥–æ–≤ —É–º–Ω—ã—Ö —É–∫–∞–∑–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–¥–∏–æ–º—É RAII –∏ —É–ø—Ä–∞–≤–ª—è—é—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞.

üìñ  –í–æ –º–Ω–æ–≥–∏—Ö —è–∑—ã–∫–∞—Ö —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É —Ä–µ—à–∞—é—Ç ¬´—Å–±–æ—Ä—â–∏–∫–∏ –º—É—Å–æ—Ä–∞¬ª. –û–Ω–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç, —Å—É—â–µ—Å—Ç–≤—É—é—Ç –ª–∏ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ –æ—Ç—Ä–µ–∑–∫–∏ –ø–∞–º—è—Ç–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –Ω–∏–∫—Ç–æ –Ω–µ —Å—Å—ã–ª–∞–µ—Ç—Å—è. –ó–∞–ø—É—Å–∫ ¬´—Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞¬ª —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–∏—Å—Ç–µ–º—ã. –û—Å–Ω–æ–≤–Ω–∞—è –∂–µ –∑–∞–¥–∞—á–∞ –°++ ‚Äî –æ–±–µ—Å–ø–µ—á–∏—Ç—å –±—ã—Å—Ç—Ä–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–¥–∞ —Å –Ω—É–ª–µ–≤—ã–º –æ–≤–µ—Ä—Ö–µ–¥–æ–º, –ø–æ—ç—Ç–æ–º—É ¬´—Å–±–æ—Ä—â–∏–∫¬ª –±—ã–ª –±—ã –Ω–µ–ø—Ä–∏–µ–º–ª–µ–º–æ–π —Ä–æ—Å–∫–æ—à—å—é. 

### –ú—å—é—Ç–µ–∫—Å—ã

–ï—Å–ª–∏ –±—ã –Ω–µ –±—ã–ª–æ RAII-–æ–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ –∫–ª–∞—Å—Å–æ–º `mutex`, –∫–æ–¥ –º–æ–≥ –±—ã –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:
```cpp
mutex mut;
// —Ñ—É–Ω–∫—Ü–∏—è RunCriticalSection ‚Äî –ø—Ä–∏–º–µ—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –¥–æ—Å—Ç—É–ø –≤ –∫–æ—Ç–æ—Ä—É—é –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
// –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∏–º —Ç—Ä–µ–¥–æ–º
void RunCriticalSection() {
    // –±–µ—Ä—ë–º –º—å—é—Ç–µ–∫—Å
    mut.lock();
    bool result = DoSomething();
    if (!result) {
        // –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –≤—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –æ—Ç–¥–∞—ë–º –º—å—é—Ç–µ–∫—Å
        mut.unlock();
        return;
    }
    bool other_result = DoSomethingElse();
    if (!other_result) {
        // –æ–ø—è—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –Ω—É–∂–Ω–æ –Ω–µ –∑–∞–±—ã—Ç—å –æ—Ç–¥–∞—Ç—å –º—å—é—Ç–µ–∫—Å
        mut.unlock();
        return;
    }
    // –≤–æ—Ç —Ç—É—Ç —É–∂–µ —Ç–æ—á–Ω–æ –≤—ã—Ö–æ–¥–∏—Ç ‚Äî –≥–ª–∞–≤–Ω–æ–µ, –Ω–µ –∑–∞–±—ã—Ç—å –ø—Ä–æ –º—å—é—Ç–µ–∫—Å
    mut.unlock();
    return;
} 
```
–î–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç —Å–ø—Ä–∞–≤–∏–ª—Å—è –∏ –Ω–µ –∑–∞–±—ã–ª –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –º—å—é—Ç–µ–∫—Å –Ω–∏ –≤ –æ–¥–Ω–æ–π –∏–∑ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –≤–µ—Ç–æ–∫ –≤—ã—Ö–æ–¥–∞, –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–æ, —á—Ç–æ —á–µ—Ä–µ–∑ –ø–∞—Ä—É –º–µ—Å—è—Ü–µ–≤ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–∏–¥—ë—Ç –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç. –û–Ω —É–∂–µ –Ω–µ –±—É–¥–µ—Ç —Ç–∞–∫ —Å–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ –º—å—é—Ç–µ–∫—Å–µ –∏ —É–ø—É—Å—Ç–∏—Ç –∫–µ–π—Å, –≥–¥–µ —Ç—Ä–µ–¥ –ø–æ–∫–∏–Ω–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é, –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏–≤ –º—å—é—Ç–µ–∫—Å.

–ö–æ–≥–¥–∞ –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–¥–æ–≤ –æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ–∂–∏–¥–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è, –∏–ª–∏ —Ä–µ—Å—É—Ä—Å–∞, —á—å—ë –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –∏–∑ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–¥–æ–≤, —Å–ª—É—á–∞–µ—Ç—Å—è –¥–µ–¥–ª–æ–∫, –∏–ª–∏ –≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞.

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –º—å—é—Ç–µ–∫—Å–∞, –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—É RAII-–æ–±—ë—Ä—Ç–∫—É `lock_guard`. –û–Ω–∞ —É–ø–æ–º–∏–Ω–∞–ª–∞—Å—å —Ä–∞–Ω–µ–µ.

### –§–∞–π–ª—ã

–ö–ª–∞—Å—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –≤ –°++ ‚Äî —É–∂–µ —Å–∞–º–∏ –ø–æ —Å–µ–±–µ RAII-–æ–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ –±–æ–ª–µ–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π. –§–∞–π–ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ.

üìñ  –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–ª–æ–∫ finally. –≠—Ç–æ—Ç –±–ª–æ–∫ –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ: –Ω–µ –≤–∞–∂–Ω–æ, –≤—ã–ª–µ—Ç–∏—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–ª–∏ –Ω–µ—Ç. finally —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –ø–æ–¥—Ö–æ–¥, —á—Ç–æ –∏ RAII. –ù–æ –≤ —Å–ª—É—á–∞–µ finally –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ–± –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤–æ –≤—Å–µ—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞, –∞ –≤ —Å–ª—É—á–∞–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ RAII —ç—Ç–æ –º–µ—Å—Ç–æ –æ–¥–Ω–æ ‚Äî –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä.

–ï—Å–ª–∏ –≤—ã –Ω–µ –≤–∏–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –æ—Ç–≤–µ—Ç–æ–≤, –ø–æ—Ç–æ–º—É —á—Ç–æ –∏—Ö –∑–∞–≥–æ—Ä–∞–∂–∏–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∞, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–∫—Ä—É—Ç–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–µ–º–Ω–æ–≥–æ –≤–Ω–∏–∑, –∏ –æ—Ç–≤–µ—Ç—ã –ø–æ—è–≤—è—Ç—Å—è.
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ —Ä–µ—Å—É—Ä—Å–∞ —É–∫–∞–∂–∏—Ç–µ –µ–≥–æ RAII-–æ–±—ë—Ä—Ç–∫—É:
- mutex ‚Äî lock_guard
- int* ‚Äî unique_ptr
- file descriptor ‚Äî fstream
- char* ‚Äî string

–ò–¥–∏–æ–º–∞ RAII ‚Äî —Å–ø–∞—Å–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –ø–æ–º–Ω–∏—Ç –æ–± —ç—Ç–æ–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –∏–ª–∏ –Ω–µ—Ç.

–í—ã –æ—Ç–ª–∏—á–Ω–æ —Å–ø—Ä–∞–≤–∏–ª–∏—Å—å —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –∏–¥–∏–æ–º—ã RAII –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö. –í–ø–µ—Ä–µ–¥–∏ –≤–∞—Å –∂–¥—ë—Ç –∑–∞–¥–∞–Ω–∏–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å RAII –Ω–µ –Ω—É–∂–Ω–æ. –≠—Ç–æ –±—É–¥–µ—Ç –∑–∞–¥–∞—á–∞-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞. –¢–∞–∫–∏–µ —á–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è—Ö. –ù—É–∂–Ω–æ –Ω–∞—É—á–∏—Ç—å—Å—è, –∫–∞–∫ –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–µ—à–∞—Ç—å.